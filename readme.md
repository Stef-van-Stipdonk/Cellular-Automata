Simple implementation based on the hats rule
